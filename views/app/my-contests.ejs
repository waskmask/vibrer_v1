<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="theme-color" content="#1e2750" />

    <meta
      name="description"
      content="Join Vibrer's prelaunch and be the first to experience a revolutionary music platform. Connect, discover, and engage with artists and music enthusiasts worldwide."
    />
    <meta
      name="keywords"
      content="music platform, music community, music discovery, artist connection, music enthusiasts"
    />
    <%- include('../partials/head'); %>

    <link rel="stylesheet" href="/public/style/app.css?v=3.0" />
    <link rel="stylesheet" href="/public/style/modal.css?v=3.0" />
    <link href="/public/style/video-js.css?v=3.0" rel="stylesheet" />
    <link rel="stylesheet" href="/public/style/contests.css?v=3.0" />
  </head>
  <body class="body-dark _pr">
    <!-- loader -->
    <%- include('../partials/loader'); %>

    <!-- header -->
    <%- include('partials/header'); %>

    <main class="app_layout app_wrapper">
      <%- include('components/app-sidebar'); %>

      <!-- main body of the app -->
      <div class="app_main">
        <div class="app_page_menu">
          <div
            onclick="toMyContests('<%= path  %>', '<%= link %>');"
            class="<%= (link == '/my-contests') ? 'active page_menu_link' : 'page_menu_link' %>"
          >
            My contests
          </div>
          <div
            class="<%= (link == '/my-contest-votes') ? 'active page_menu_link' : 'page_menu_link' %>"
            onclick="toMyVotes('<%= link %>');"
          >
            My votes
          </div>
          <div
            class="<%= (link == '/my-contest-favs') ? 'active page_menu_link' : 'page_menu_link' %>"
            onclick="toMyContestFavs('<%= link %>');"
          >
            Favorites
          </div>
        </div>

        <div class="myContestCard mt-3 mb-3 shadow">
          <div class="flex-title">
            <span>Vibrer Singing Contests</span>
            <div class="status active">Active</div>
          </div>
          <div class="text white">Ends in 22 days</div>
          <div class="text primary mt-2">Your submission</div>
          <div class="contestant">
            <div class="head">
              <video
                controls
                class="video-js"
                preload="auto"
                width="640"
                height="264"
                data-setup="{}"
              >
                <source src="/uploads/inescapable.mp4" type="video/mp4" />
                <source src="/uploads/inescapable.mp4" type="video/webm" />
                <p class="vjs-no-js">
                  To view this video please enable JavaScript, and consider
                  upgrading to a web browser that
                  <a
                    href="https://videojs.com/html5-video-support/"
                    target="_blank"
                    >supports HTML5 video</a
                  >
                </p>
              </video>
            </div>
            <div class="body">
              <!-- inactive | active | review -->
              <div class="postStatus active">Active</div>
              <div class="votes">
                <div class="count">
                  <strong>Votes:</strong> <span>2036</span>
                </div>
                <div class="rank">
                  <strong>Current Rank:</strong> <span>20 </span>
                </div>
              </div>

              <div class="cta">
                <button
                  class="btn btn-outlined"
                  onclick="confirmDelete('1234533444')"
                >
                  Withdraw
                </button>
                <button
                  class="btn btn-outlined"
                  data-toggle="_modal"
                  data-target="shareModal"
                >
                  Share
                </button>
                <button class="btn btn-primary">Visit contest</button>
              </div>
            </div>
          </div>
        </div>

        <!-- app main end -->
      </div>

      <!-- right side section of the app -->
      <div class="app_right cs-scroll">
        <div class="artists">
          <div
            data-id="user._id"
            class="artist_wrapper mb-3"
            style="background-image: url('/public/images/singer.png')"
          >
            <div class="overlay"></div>
            <div class="_user">
              <img src="/uploads/profileDemo.png" alt="User" />
              <div class="info">
                <div class="name">
                  <span>Jessica Hub</span>
                  <img
                    class="app_v_badge"
                    src="/public/images/icons/verified-badge.svg"
                    alt="badge"
                  />
                </div>
                <div class="uname">@jhub</div>
              </div>
            </div>
          </div>

          <div
            data-id="user._id"
            class="artist_wrapper mb-3"
            style="background-image: url('/uploads/coverDemo.jpeg')"
          >
            <div class="overlay"></div>
            <div class="_user">
              <img src="/uploads/profileDemo.png" alt="User" />
              <div class="info">
                <div class="name">
                  <span>Jessica Hub</span>
                  <img
                    class="app_v_badge"
                    src="/public/images/icons/verified-badge.svg"
                    alt="badge"
                  />
                </div>
                <div class="uname">@jhub</div>
              </div>
            </div>
          </div>

          <div
            data-id="user._id"
            class="artist_wrapper mb-3"
            style="background-image: url('/uploads/coverDemo.jpeg')"
          >
            <div class="overlay"></div>
            <div class="_user">
              <img src="/uploads/profileDemo.png" alt="User" />
              <div class="info">
                <div class="name">
                  <span>Jessica Hub</span>
                  <img
                    class="app_v_badge"
                    src="/public/images/icons/verified-badge.svg"
                    alt="badge"
                  />
                </div>
                <div class="uname">@jhub</div>
              </div>
            </div>
          </div>

          <div class="app_right_link">
            <div class="link">View all</div>
          </div>
        </div>
      </div>
    </main>
    <%- include('../modals/shareModal'); %>
    <!-- javascript -->
    <script src="/public/js/redirections.js?v=3.0"></script>
    <script src="/public/js/general.js?v=3.0"></script>
    <script src="/public/js/_modal.js?v=3.0"></script>
    <script src="/public/js/video.min.js?v=3.0"></script>
    <script src="/public/js/Youtube.min.js?v=3.0"></script>
    <!-- Include SweetAlert2 from CDN in your EJS file -->
    <script src="/public/js/sweetalert2@11.js?v=3.0"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Event listener for WhatsApp share buttons
        var whatsappButtons = document.querySelectorAll(".btn-whatsapp");
        whatsappButtons.forEach(function (button) {
          button.addEventListener("click", function () {
            var url = this.getAttribute("data-url");
            window.open(url, "_blank");

            // Close the modal after 1 second
            setTimeout(() => closeCurrentModal(this), 1000);
          });
        });

        // Event listener for Copy URL buttons
        var copyButtons = document.querySelectorAll(".copy-url-btn");
        copyButtons.forEach(function (button) {
          button.addEventListener("click", function () {
            // Copy URL to clipboard
            var url = this.getAttribute("data-url");
            navigator.clipboard
              .writeText(url)
              .then(() => {
                // Store the original button text
                var originalText = button.textContent;

                // Change button text to 'Copied!'
                button.textContent = "Copied!";

                // Change the text back to the original after 2 seconds
                setTimeout(function () {
                  button.textContent = originalText;
                }, 2000);

                // Close the modal after 1 second
                setTimeout(() => closeCurrentModal(this), 1000);
              })
              .catch((err) => {
                console.error("Could not copy text: ", err);
              });
          });
        });

        // Function to close the current modal
        function closeCurrentModal(button) {
          var modal = button.closest("._modal");
          if (modal) {
            closeModal(modal);
          }
        }
      });
      // Your existing closeModal function
      function closeModal(modal) {
        var dialog = modal.querySelector(".dialog");
        if (dialog) {
          dialog.classList.remove("show");
          dialog.addEventListener(
            "transitionend",
            function () {
              modal.classList.remove("d-block");
              document.body.classList.remove("modal-open");
            },
            { once: true }
          );
        }
      }
    </script>
    <script>
      function confirmDelete(postId) {
        Swal.fire({
          title: "Are you sure?",
          text: "Do you want to withdraw from this contest? you'll lose your votes as well and you won't be able to revert this!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#fb6580",
          cancelButtonColor: "#4b5891",
          confirmButtonText: "Yes, delete it!",
        }).then((result) => {
          if (result.isConfirmed) {
            fetch("/delete-post/" + postId, { method: "POST" })
              .then((response) => {
                if (response.ok) {
                  Swal.fire(
                    "Deleted!",
                    "Your post has been deleted.",
                    "success"
                  );
                  // Refresh page or update UI accordingly
                  window.location.reload();
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                Swal.fire("Error!", "Something went wrong.", "error");
              });
          }
        });
      }
    </script>
    <script>
      var players = [];

      var videoElements = document.querySelectorAll(".video-js");

      for (var i = 0; i < videoElements.length; i++) {
        var player = videojs(videoElements[i]);

        // Store the player instance in the array
        players.push(player);

        // Add event listener to each player
        player.on("play", function () {
          pauseOtherPlayers(this);
        });
        player.on("seeking", function () {
          player.muted(true);
        });

        player.on("seeked", function () {
          player.muted(false);
        });
      }
      function pauseVideo() {
        player.pause();
      }
      // Function to pause all players except the currently playing one
      function pauseOtherPlayers(currentPlayer) {
        players.forEach(function (player) {
          if (player !== currentPlayer) {
            player.pause();
          }
        });
      }
    </script>
  </body>
</html>
