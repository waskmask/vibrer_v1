<!DOCTYPE html>
<html lang="en">
  <head>
    <meta
      name="description"
      content="Join Vibrer's prelaunch and be the first to experience a revolutionary music platform. Connect, discover, and engage with artists and music enthusiasts worldwide."
    />
    <meta
      name="keywords"
      content="music platform, prelaunch, music community, music discovery, artist connection, music enthusiasts"
    />
    <%- include('partials/head'); %>
    <link rel="stylesheet" href="/public/style/app.css?v=2.0" />
  </head>

  <body>
    <!-- Loader -->
    <%- include('partials/loader'); %>
    <main>
      <section class="auth auth-pages" id="forgot-password">
        <div class="auth-container">
          <img class="bg-img" src="/public/images/auth-pass.jpg" alt="Image" />
          <div class="overlay"></div>
          <div class="left-col">
            <div class="title">
              Vibrer is your one-stop destination for all things music, So what
              are you waiting for?
            </div>
          </div>
          <div class="auth-col">
            <div class="form-wrapper">
              <img
                class="logo"
                src="/public/images/vibrer_light_logo.svg"
                alt="Logo"
              />
              <div class="title">Set New Password</div>
              <div class="sub">
                You're almost there! Please enter your new password below. Make
                sure your password is strong and secure to protect your account.
              </div>
              <div class="success-message mb-3">
                Your password has been successfully changed. You can now log in
                with your new password. Remember to keep your password
                confidential and avoid using the same password for multiple
                sites.
              </div>
              <form
                action="javascript:void(0)"
                class="w-100"
                method="POST"
                autocomplete="off"
                id="resetPasswordForm"
              >
                <input type="hidden" name="token" value="<%- token %>" />
                <div class="mb-3 passInputDiv">
                  <input
                    class="form-input"
                    type="password"
                    placeholder="Password"
                    name="password"
                    id="password"
                    required
                    autocomplete="off"
                  />
                  <div class="passInput">
                    <img src="/public/images/icons/visibility.svg" alt="Icon" />
                  </div>
                </div>

                <div class="mb-3 passInputDiv">
                  <input
                    class="form-input"
                    type="password"
                    placeholder="Confirm password"
                    name="confirmPassword"
                    autocomplete="off"
                    required
                    id="confirmPassword"
                  />
                  <div class="passInput">
                    <img src="/public/images/icons/visibility.svg" alt="Icon" />
                  </div>
                </div>

                <button
                  class="btn btn-primary w-100 mt-4 submitBtn"
                  type="submit"
                >
                  Update Password
                </button>
              </form>

              <div class="mt-4 dfac">
                <a class="link-primary dfac ms-1" href="/login">
                  <img
                    src="./public/images/icons/arrow-left-long-primary.svg"
                    alt="icon"
                  />
                  Go back to login
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <!-- javascript -->
    <script src="/public/js/cookieBanner.js?v=2.0"></script>
    <script src="/public/js/theme-v01node.js?v=2.0"></script>
    <script src="/public/js/authForm.js?v=2.0"></script>
    <script src="/public/js/sweetalert2@11.js?v=2.0"></script>
    <script src="/public/js/config.js?v=2.0"></script>
    <script>
      function toForgotPass() {
        window.location.href = "/forgotpass";
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("resetPasswordForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();
            const btn = document.querySelector(".submitBtn");
            btn.textContent = "Loading...";
            btn.disabled = true;

            // Serialize the form data into a JavaScript object
            var formData = new FormData(this);
            var jsonData = {};
            formData.forEach(function (value, key) {
              jsonData[key] = value;
            });

            try {
              // Make a POST request using fetch
              const response = await fetch(`${API_URL}appUser/reset-password`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(jsonData),
              });

              if (response.ok) {
                const result = await response.json();

                if (result.status === 1) {
                  Swal.fire({
                    position: "center",
                    icon: "success",
                    title: "Success",
                    text: result.message,
                    showConfirmButton: false,
                    timer: 2100,
                  }).then(() => {
                    window.location.href = "/login";
                  });
                } else {
                  Swal.fire({
                    position: "center",
                    icon: "error",
                    title: "Oops...",
                    text: result.message,
                    showConfirmButton: false,
                    timer: 2100,
                  });
                }
              } else {
                const errorResponse = await response.json();
                const errorMessage =
                  errorResponse.error || errorResponse.message;

                Swal.fire({
                  position: "center",
                  icon: "error",
                  title: "Oops...",
                  text: errorMessage,
                  showConfirmButton: false,
                  timer: 2100,
                });
              }
              btn.textContent = "Update Password";
              btn.disabled = false;
            } catch (error) {
              console.error("Error:", error);

              Swal.fire({
                position: "center",
                icon: "error",
                title: "Oops...",
                text: "An error occurred while processing your request.",
                showConfirmButton: false,
                timer: 2100,
              });
              btn.textContent = "Update Password";
              btn.disabled = false;
            }
          });
      });
    </script>
  </body>
</html>
